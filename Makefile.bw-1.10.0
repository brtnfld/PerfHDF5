#!/usr/bin/env make

#  remember to: module load cray-hdf5-parallel 
CXX=h5pcc
#CXX=CC
#CXXFLAGS=-Wall -O2  -lstdc++
CXXFLAGS=-O2 -lstdc++
#CXXFLAGS=-O2 
#CXXFLAGS=-Wall -O0 -g -std=c++0x
#CXX_INCLUDES=/usr/include/c++/4.3/

#IFLAGS=-I/u/sciteam/willmore/local/phdf5-1.10.0-install/include -I${CXX_INCLUDES}
#LFLAGS=-L/u/sciteam/willmore/local/phdf5-1.10.0-install/lib -lhdf5

#	CC -I/u/sciteam/willmore/local/phdf5-1.10.0-install/include -I/usr/lib64/include -DCRAYCC -dynamic -O2 -L/u/sciteam/willmore/local/phdf5-1.10.0-install/lib -lhdf5 -L/opt/cray/mpt/7.2.4/gni/mpich2-CRAY64/8.3/lib -lmpichcxx_cray_default64 seism-core-slice.o 

#all: seism-core

seism-core-slice: seism-core-slice.o
	CC -DCRAYCC -dynamic -O2 -L/u/sciteam/willmore/local/phdf5-1.10.0-install/lib -lhdf5 -L/opt/cray/mpt/7.2.4/gni/mpich2-CRAY64/8.3/lib -lmpichcxx_cray_default64 seism-core-slice.o -o seism-core-slice

seism-core-slice.o: seism-core-slice.cc
	CC -I/u/sciteam/willmore/local/phdf5-1.10.0-install/include -I/usr/lib64/include -DCRAYCC -dynamic -O2 -c seism-core-slice.cc 



check-slice: seism-core-slice
	aprun -N8 -n 8 ./seism-core-slice < tests/bw/check-8-pre
	aprun -N16 -n 16 ./seism-core-slice < tests/bw/check-16-pre
	aprun -N32 -n 32 ./seism-core-slice < tests/bw/check-32-pre
	aprun -N32 -n 64 ./seism-core-slice < tests/bw/check-64-pre
	aprun -N32 -n 128 ./seism-core-slice < tests/bw/check-128-pre
	aprun -N32 -n 256 ./seism-core-slice < tests/bw/check-256-pre





seism-core: seism-core.o
	$(CXX) $(CXXFLAGS) $(IFLAGS) $(LFLAGS) seism-core.o -o $@

seism-core.o: seism-core.cc
	$(CXX) $(CXXFLAGS) $(IFLAGS) $(LFLAGS) -c $< -o $@

clean:
	rm -f *.o *.h5

veryclean: clean
	rm -f seism-core


